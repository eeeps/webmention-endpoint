<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>ðŸªµ</title>
<meta name="viewport" content="width=device-width">
<style>
html {
	font-family: system-ui, sans-serif;
}
ol {
	list-style: none;
	padding: 0;
}
li {
	margin: 1em;
	border-top: 1px solid gray;
}
li.noneYet {
	font-style: italic;
	color: gray;
	padding: 1em;
}
li:last-child {
	border-bottom: 1px solid gray;
}
small {
	color: gray;
}
dl {
	display: table;
}
dl > div {
	display: table-row;
	font-family: menlo, monospace;
}
dt {
	display: table-cell;
  white-space: nowrap;
	padding: 0.5ch;
  padding-right: 1.5em;
}
dt::after {
	content: ':';
  float: right;
	margin-right: -1em;
	color: gray;
}
dd {
	display: table-cell;
	padding: 0.5ch;
}

</style>
</head>
<body>

<h1>Beacon ðŸªµ</h1>

<ol id="log">
<li class="noneYet">We havenâ€™t received any beacons yet.</li>
</ol>

<script>
const es = new EventSource( '/events' );
const log = document.querySelector( '#log' );

es.addEventListener( 'message', ( event ) => {
	
	const li = document.createElement( 'li' );
	
	const json = JSON.parse( event.data );
	const id = event.lastEventId;
	
	const small = document.createElement( 'small' );
	small.textContent = id;
	
	
  
  // if there's a path
  if ( json.path !== '' ) {
    
  }
  
  // if there's a body
  if ( Object.keys( json.body ) && Object.keys( json.body ).length > 0 ) {
    
  }
  
  // if there are query parameters
  if ( Object.keys( json.queryParameters ) && Object.keys( json.queryParameters ).length > 0 ) {
    const h2 = document.createElement( 'h2' );
    h2.textContent = 'Query parameters'
    const dl = document.createElement( 'dl' );
    for ( const key of Object.keys( json.queryParameters ) ) {
      const div = document.createElement( 'div' );
      const dt = document.createElement( 'dt' );
      dt.textContent = key;
      const dd = document.createElement( 'dd' );
      dd.textContent = json.queryParameters[ key ];
      div.appendChild( dt );
      div.appendChild( dd );
      dl.appendChild( div );
    }
    li.appendChild( h2 );
    li.appendChild( dl );
  }
  

	li.appendChild( small );
	
	const waiting = document.querySelector('.noneYet');
	
	if ( waiting ) {
		waiting.replaceWith( li );
	} else {
		log.appendChild( li );
	}
	
} );

</script>

</body>
</html>